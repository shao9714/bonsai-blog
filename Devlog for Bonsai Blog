Devlog for Bonsai Blog - Started Oct 9th

Oct 21st

想到最后还是给盆栽博客开个log吧。本来以为写纯文字CRUD网站应用会简单些，没想到小问题还是挨个出个个出。
报的Express课帮助有限，因为Mongoose太好用了！！好多功能都可以直接对接上现有的函数，要不是mysql里没有就是我不知道。既然会选择Mongodb那我就姑且默认是没有了。
中途碰到不少小bug，摸摸索索过来感觉主要障碍都不是什么大问题，基本都是自己的大意和不熟悉。（可是记下来还是有参考价值的，可惜。）唯一碰到的比较严重的问题就是可能要替换tinyMCE。
这个问题是个小bug里套了个大bug。一开始难倒我的是不知道怎么在tinyMCE里设置从数据库里调出来的默认文字。用网上给的init函数不起作用，script的摆放位置也都试了，头发都抓秃了发现是因为我已经init过一次了。在header里小小一行。为了把默认语言调成中文。很明显调成中文以后我就忘了这茬了。
改完以后成功了，能编辑了。黏贴插件也能用了......啊不能用！！！然后发现了大bug。TinyMCE不会处理内容里的\n，在页面里直接编辑没有这个问题，所以可能是黏贴插件的问题。精力（自信心）有限我没去系统性复现，但是观察到的问题都是在有黏贴内容的博文里，很大可能还是来自插件。也有小小的可能是因为特殊字符。总之问题体现在文档里有换行，pug就会出EOF报错，因为换行不会被自动转换为</br>，只会在渲染前被当成pug里的真换行。找了一圈发现TinyMCE似乎没有自带的处理这个问题的方法，我就手动在后端把所有\n啊，\r啊换成</br>了。本来以为万事大吉，结果，还是不行！！TinyMCE在处理文本的时候好像会无视文字html里的</br>，然后把编辑
器里的\n再存一遍。导致只要文字里有我手动转的</br>，它就会随着编辑次数增殖。
本来到这里以为已经没有希望了，不能保留原本的\n，也不能手动转</br>，要改就只能替换掉TinyMCE。 把文本输入全改一遍。二次秃
头。
这个能解决纯粹是运气，SO上找到有人四年前问过这个问题。回答的大佬在源代码里找到了往html里加\n的那段码：
	if (indent && indentAfter[name] && html.length > 0) {
        value = html[html.length - 1];

        if (value.length > 0 && value !== '\n') {
            html.push('\n');
        }
    }
然后把indent手动设置成false关掉了这个迷之功能。
比较迷惑的是这个indent的设置不在TinyMCE的文档里，不翻源代码真的找不到。如果没有大佬代行我估计就得和哼哧好几天的插件再见了👋。
总而言之，改完以后最基础的浏览，新建，编辑，删除功能都能正常运行了。多亏了大佬。

接下来需要做的几项主要内容：分页，标签系统，搜索，根据条件的排序。
因为没什么必要，而且好像还挺复杂的我就把上传封面图的功能先去掉了。

纪念一下，解决我TinyMCE问题的SO连接：https://stackoverflow.com/questions/37205014/tinymce-is-adding-new-line-n-regardless-of-apply-source-formatting。

现在正在研究怎么加标签还有设置标签系统。
在参考这个↓ 为了便捷程度打算先用第一个，做出来再说，不过我打算先解决前端的问题
http://howto.philippkeller.com/2005/04/24/Tags-Database-schemas/

新建的前端搞定了！扒了之前课件的代码。其实差不多，用dom manipulation在前端加入了一串bootstrap badges。比我想象中要简单。

后端也改好了！现在是要把前端的显示也加上，要做wrapping和数量限制有点虚。
行距bug还在！！！啊啊啊啊啊。
我，一拳上去（意指直接把所有第一次新建文档的换行都去掉了）姑且，修好了。

Oct 23rd

昨天处理掉了删除时候的确认栏。今天搞定了标签的跳转和搜索，虽然只支持同时搜索一个标签。
差不多是可以用的程度了，还差着安全保障和用户功能没写，现在不打算做什么了。
没想到搜索和标签能这么快搞定来着....。这个项目说实话有点想搁置。写到这个程度是不错的综合express操作练习，如果想要在express上再有进步的话需要去继续上课，上完课多写小project习惯下文档结构和app结构等等。如果要继续这个博客项目接下来应该最有意义的就是写出用户和编辑文章的权限，可惜我还不会，先上课。






